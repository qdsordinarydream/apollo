<!--
  ~ Copyright 2024 Apollo Authors
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~ http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  ~
-->
<!DOCTYPE html>
<html lang="en" ng-app="login">

<head>
    <meta charset="UTF-8">
    <title>{{ 'Common.Title' | translate }}</title>
    <link rel="icon" href="./img/config.png">
    <link rel="stylesheet" type="text/css" href="vendor/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="vendor/font-awesome.min.css">
    <style type="text/css">
        body {
            font-family: 'Roboto', sans-serif;
        }

        .login-container {
            width: 100%;
            height: 100vh;
            position: relative;
        }

        .login_bg {
            position: absolute;
            top: 0;
            left: 0;
            z-index: -1;
            width: 100%;
            height: 100%;
            background: url('./img/login_bg.png') no-repeat;
            background-size: cover;
        }

        .login-header {
            padding: 25px;
        }

        .logo-chart {
            position: absolute;
            left: 10%;
            top: 0;
            width: 40%;
            height: 100vh;
            background: url('img/chart.png') no-repeat center center;
            background-size: contain;
            transition: all 0.3 linear;
        }

        .login_content {
            height: calc(100vh - 150px);
            display: flex;
            align-items: center;
            justify-content: end;
            padding-right: 200px;
            transition: all 0.3 linear;
        }

        .login-box {
            background: #fff;
            width: 438px;
            height: 545px;
            border-radius: 10px;
            opacity: 0.8;
            box-shadow: 0px 11px 23px 0px rgba(166, 195, 236, 0.7), 0px 29px 133px 0px rgba(86, 143, 224, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .logo-text {
            padding-top: 170px;
        }

        .text-description {
            color: #575757;
            line-height: 16px;
            padding-bottom: 32px;
            padding-top: 8px;
        }

        .rights-define {
            justify-self: end;
            line-height: 20px;
            text-align: center;
            margin-top: auto;
            margin-bottom: 12px;
        }

        .rights-define p {
            font-size: 12px;
        }
        .btn-login {
            color: #fff;
            background-color: #409eff;
            cursor: pointer;
            border: 0;
            display: inline-block;
            line-height: 1;
            white-space: nowrap;
            text-align: center;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            outline: 0;
            margin: 0;
            -webkit-transition: .1s;
            transition: .1s;
            font-weight: 500;
            padding: 12px 20px;
            font-size: 14px;
            border-radius: 4px;
            margin-left: 30px;
        }
        .btn-login::hover {
            box-shadow: 0 0 5px #efefef;
        }

        .btn-login-mtg {
            color: #fff;
            background-color: #409eff;
            cursor: pointer;
            border: 0;
            display: inline-block;
            line-height: 1;
            white-space: nowrap;
            text-align: center;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            outline: 0;
            margin: 0;
            -webkit-transition: .1s;
            transition: .1s;
            font-weight: 500;
            padding: 12px 20px;
            font-size: 14px;
            border-radius: 4px;
            margin-top: 20px;
        }
        .btn-login-mtg::hover {
            box-shadow: 0 0 5px #efefef;
        }

        @media screen and (max-width: 768px) {
            .login-container {
                .logo-chart {
                    width: 100%;
                    left: 0;
                }
            }

            .login_content {
                padding: 0 32px;
                justify-content: center;

                .login-box {
                    opacity: .9;
                }
            }
        }
    </style>
</head>

<body>
<div class="login-container">
    <div class="login_bg"></div>

    <div class="login-header">
        <img width="30" src="./img/configCenter.png" alt="galaxy">
        <img width="90" src="./img/configCenterTextLogo.png" alt="galaxy">
    </div>

    <div class="logo-chart"></div>

    <div class="login_content">

        <div class="login-box">
            <img class="logo-text" width="176" src="./img/configCenterTextLogo.png" alt="config center">
            <div class="text-description">
                A reliable configuration management system
            </div>

            <div class="login-actions-form">
                <form id="login-form" action="signin" method="post" role="form" style="display: block;">
                    <div class="form-group">
                        <input type="text" name="username" tabindex="1" class="form-control"
                               placeholder="Username" value="">
                    </div>
                    <div class="form-group">
                        <input type="password" name="password" tabindex="2"
                               class="form-control" placeholder="Password">
                    </div>
                    <button class="btn-login ng-binding">{{'Login.Login' | translate }}</button>
                </form>
            </div>

            <div class="login-actions">
                <button class="btn-login-mtg ng-binding">{{'Login.LoginMTG' | translate }}</button>
            </div>

            <div class="rights-define">
                Copyright © 2022~2024 Config Center
            </div>
        </div>
    </div>
</div>

<!-- jquery.js -->
<script src="vendor/jquery.min.js" type="text/javascript"></script>
<!-- bootstrap.js -->
<script src="vendor/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>

<!--angular-->
<script src="vendor/angular/angular.min.js"></script>
<script src="vendor/angular/angular-resource.min.js"></script>
<script src="vendor/angular/angular-toastr-1.4.1.tpls.min.js"></script>
<script src="vendor/angular/loading-bar.min.js"></script>
<script src="vendor/angular/angular-cookies.min.js"></script>

<script src="vendor/angular/angular-translate.2.18.1/angular-translate.min.js"></script>
<script src="vendor/angular/angular-translate.2.18.1/angular-translate-loader-static-files.min.js"></script>
<script src="vendor/angular/angular-translate.2.18.1/angular-translate-storage-cookie.min.js"></script>

<script type="application/javascript">
    function getPrefixPath() {
        $.ajax({
            method: 'get',
            async: false,
            url: 'prefix-path',
            success: function (res) {
                window.localStorage.setItem("prefixPath", res);
            }
        })
    }

    getPrefixPath();
</script>

<script type="application/javascript" src="scripts/app.js"></script>
<script type="application/javascript" src="scripts/AppUtils.js"></script>
<script type="application/javascript" src="scripts/directive/directive.js"></script>
<script type="application/javascript" src="scripts/controller/LoginController.js"></script>


<script type="application/javascript">

    $(function () {
        $('#login-form-link').click(function (e) {
            $("#login-form").delay(100).fadeIn(100);
            $("#register-form").fadeOut(100);
            $('#register-form-link').removeClass('active');
            $(this).addClass('active');
            e.preventDefault();
        });
        $('#register-form-link').click(function (e) {
            $("#register-form").delay(100).fadeIn(100);
            $("#login-form").fadeOut(100);
            $('#login-form-link').removeClass('active');
            $(this).addClass('active');
            e.preventDefault();
        });

        $.get('/api/env', function (data) {
            console.log(data)
            if (data === true) {
                $('#login-form').show();
            } else {
                $('#login-form').hide();
            }
        });

        $('.btn-login').click(function (e) {
            e.stopPropagation();  // 阻止事件冒泡
            login()
        })

        function loginMaxConnect(routePath = '/login.html', refer = '') {
            const appKey = "e0046a3ed06ea274b184e9c6a2c8253d"
            const url = window.location.origin + routePath
            window.location.href = `https://connect.spotmaxtech.com/api/v1/connect/authorize?appkey=${appKey}&redirect_uri=${encodeURIComponent(url)}&state=${encodeURIComponent(refer)}`
        }

        $('.btn-login-mtg').click(function (e) {
            loginMaxConnect()
        })

        function login(code) {
            const formData = new FormData()

            // If form values exist, use them instead of the provided code
            if (code !== undefined && code !== null) {
                console.log("使用账户中心登陆")
                formData.append('username', code)
                formData.append('password', "apollo")
            } else {
                console.log("使用账密登陆")
                var username = $('input[name="username"]').val();
                var password = $('input[name="password"]').val();
                console.log(username + " | " + password)

                formData.append('username', username)
                formData.append('password', password)
            }

            $.ajax({
                method: 'post',
                async: false,
                processData: false,
                contentType: false,
                data: formData,
                url: 'signin',
                success: function (res) {
                    // console.log('登录成功')
                    window.location.href = window.localStorage.getItem('prefixPath') + '/index.html'
                },
                error: function (err) {
                    window.alert(err.message || '登录失败，请重试')
                }
            })
        }

        function getQueryParam(param) {
            var url = window.location.href;
            var params = url.substring(url.indexOf('?') + 1).split('&');
            for (var i = 0; i < params.length; i++) {
                var pair = params[i].split('=');
                if (pair[0] === param) {
                    return decodeURIComponent(pair[1]);
                }
            }
            return null;
        }

        function beforeLogin() {
            var code = getQueryParam('code');
            // console.log(code);
            if (code !== undefined && code !== null) {
                login(code)
            }
        }

        beforeLogin()
    });

</script>
</body>
</html>